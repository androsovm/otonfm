# CLAUDE.md




Этот файл содержит рекомендации для работы с кодом репозитория Oton.FM.

## О проекте Oton.FM
Oton.FM — это радио-приложение для якутской диаспоры:
- Якутская и международная музыка
- Программы и шоу на якутском языке
- Культурный контент для якутского сообщества
- Прямой эфир и on-demand контент

## Основные реализованные фичи
- **Современный UI в стиле Spotify**: темный градиентный фон, крупная обложка альбома, плавные анимации и переходы
- **Буферизация аудио**: при кратковременных проблемах с интернетом воспроизведение не прерывается, реализован автоматический рестарт потока при длительной буферизации
- **Адаптивный дизайн**: фиксированные позиции элементов для исключения "прыжков" интерфейса, корректное отображение длинных названий треков
- **Умная загрузка обложек**: двойной запрос обложек для надежного обновления при смене трека, автоматическая замена логотипа станции на дефолтную обложку
- **RevenueCat интеграция**: возможность приобретения подписки через PaywallView с автоматическим показом на 3, 6 и 15 день
- **Тактильная обратная связь**: haptic feedback для улучшения пользовательского опыта
- **Стильный темный интерфейс**: темный градиентный фон во всех элементах, включая загрузочный экран
- **Анимированные состояния**: анимированные точки в тексте "Подключение..." для улучшения визуальной обратной связи
- **Анимированные градиенты Якутии**: если у трека нет обложки, фон состоит из плавно меняющихся градиентов yakutiaGradients (смена каждые 10 секунд, переход 3 секунды, стартовый градиент выбирается случайно)
- **UX-логика дефолтной обложки**: если хоть раз была показана реальная обложка трека, дефолтная больше не затирает её до смены трека. Логотип станции не считается реальной обложкой.

## Build-команды
- Сборка: `xcodebuild -scheme Oton.FM -destination 'platform=iOS Simulator,name=iPhone 15' build`
- Тесты: `xcodebuild test -scheme Oton.FM -destination 'platform=iOS Simulator,name=iPhone 15'`
- Запуск одного теста: `xcodebuild test -scheme Oton.FM -destination 'platform=iOS Simulator,name=iPhone 15' -only-testing:Oton.FMTests/TestClassName/testMethodName`

## Code Style Guidelines
- PascalCase для типов (structs, classes), camelCase для свойств/методов
- Импорты по одному на строке, сначала SwiftUI
- Обработка ошибок через do-catch с понятными print-сообщениями
- Расширения (extensions) в конце файла
- Явное private для приватных свойств
- SwiftUI: property wrappers, модификаторы по одному на строке, ZStack/VStack/HStack для layout, анимации через `.animation(.easeInOut(duration: 0.5), value: ...)`
- Архитектура: MVVM, ObservableObject для view models
- Русские комментарии допустимы для отладки, но в финальном коде должны быть на английском

## Особенности реализации
- **Интерфейс**: закрепленная структура с фиксированными высотами для плавных переходов
- **Обложки треков**: механизм обхода кэширования API и сравнение метаданных для корректного отображения
- **Анимации**: плавные переходы с .combined анимациями для opacity и движения
- **Цветовая схема**: адаптивная, основанная на цвете обложки текущего трека
- **Градиентный фон**: динамически меняется в зависимости от цвета обложки или плавно анимируется из yakutiaGradients, если обложки нет
- **Буферизация**: индикация внутри кнопки воспроизведения для сохранения стабильности интерфейса
- **Темный загрузочный экран**: использование UILaunchScreen с настроенным темным цветом фона
- **Анимированные точки**: компонент AnimatedDots для анимации точек в тексте "Подключение..."
- **Автоматический показ paywall**: отслеживание дней использования и показ на 3, 6 и 15 день
- **Режим тестирования paywall**: скрытый режим активируется при длительном нажатии на иконку подарка
- **Анимированные градиенты Якутии**: плавная смена красивых тематических градиентов, вдохновлённых природой и культурой региона
- **Случайный старт градиента**: при каждом новом показе дефолтной обложки стартовый градиент выбирается случайно

## Темы градиентов yakutiaGradients (русские названия)
1. Летний день в Якутии
2. Закат в бескрайней тундре
3. Рассвет над рекой Леной
4. Звездное небо Якутии
5. Северное сияние над якутскими просторами
6. Морозное зимнее утро в Якутии
7. Тайга в летнюю пору
8. Ысыах — праздник лета в Якутии
9. Горы Верхоянского хребта
10. Осенние краски долины Туймаада
11. Драгоценные камни Якутии
12. Утренний туман над рекой Леной
13. Полярный день — светлое небо и холодный воздух
14. Ледяная сказка — морозные узоры и голубой лёд
15. Тёплый чум — уют и тепло в зимней ночи
16. Летний дождь — свежесть зелени и прохлада воды
17. Сказочный лес — мягкая зелень и солнечные лучи
18. Янтарный вечер — тёплый свет заката
19. Розовый рассвет — нежные облака и голубое небо
20. Голубой лёд — прозрачность и свежесть зимы
21. Традиционный орнамент — красные и золотые мотивы
22. Уютный костёр — тепло и свет в зимнем лесу

## Структура проекта
```
Oton.FM/
├── Models/               # Модели данных
│   ├── PlayerState.swift
│   ├── TrackInfo.swift
│   └── RadioError.swift
├── Views/               # UI компоненты
│   ├── Components/      # Переиспользуемые компоненты
│   │   ├── AnimatedDots.swift
│   │   └── ErrorView.swift
│   └── Player/          # Компоненты плеера
│       ├── PlayerControlsView.swift
│       ├── ArtworkView.swift
│       └── TrackInfoView.swift
├── Services/            # Сервисы (будущие)
├── Utilities/           # Вспомогательные утилиты
└── ContentView.swift    # Основной экран

## Потенциальные улучшения (идеи для будущих фич)
- Таймер сна (Sleep Timer)
- Кнопка "Поделиться" текущим треком
- Избранное (Favorites)
- История прослушанных треков
- Индикация качества соединения
- Виджет "Сейчас играет"
- Анимация/визуализация звука
- Ссылки на сайт/соцсети радио
- Оптимизация энергопотребления при длительном воспроизведении
- Локальное кэширование обложек для экономии трафика