# CLAUDE.md

Этот файл содержит рекомендации для работы с кодом репозитория Oton.FM.

## О проекте Oton.FM
Oton.FM — это радио-приложение для якутской диаспоры:
- Якутская и международная музыка
- Программы и шоу на якутском языке
- Культурный контент для якутского сообщества
- Прямой эфир и on-demand контент

## Основные реализованные фичи
- **Современный UI в стиле Spotify**: темный градиентный фон, крупная обложка альбома, плавные анимации и переходы
- **Буферизация аудио**: при кратковременных проблемах с интернетом воспроизведение не прерывается, реализован автоматический рестарт потока при длительной буферизации
- **Адаптивный дизайн**: фиксированные позиции элементов для исключения "прыжков" интерфейса, корректное отображение длинных названий треков
- **Умная загрузка обложек**: двойной запрос обложек для надежного обновления при смене трека, автоматическая замена логотипа станции на дефолтную обложку
- **RevenueCat интеграция**: возможность приобретения подписки через PaywallView с автоматическим показом на 3, 6 и 15 день
- **Тактильная обратная связь**: haptic feedback для улучшения пользовательского опыта
- **Стильный темный интерфейс**: темный градиентный фон во всех элементах, включая загрузочный экран
- **Анимированные состояния**: анимированные точки в тексте "Подключение..." для улучшения визуальной обратной связи

## Build-команды
- Сборка: `xcodebuild -scheme Oton.FM -destination 'platform=iOS Simulator,name=iPhone 15' build`
- Тесты: `xcodebuild test -scheme Oton.FM -destination 'platform=iOS Simulator,name=iPhone 15'`
- Запуск одного теста: `xcodebuild test -scheme Oton.FM -destination 'platform=iOS Simulator,name=iPhone 15' -only-testing:Oton.FMTests/TestClassName/testMethodName`

## Code Style Guidelines
- PascalCase для типов (structs, classes), camelCase для свойств/методов
- Импорты по одному на строку, сначала SwiftUI
- Обработка ошибок через do-catch с понятными print-сообщениями
- Расширения (extensions) в конце файла
- Явное private для приватных свойств
- SwiftUI: property wrappers, модификаторы по одному на строку, ZStack/VStack/HStack для layout, анимации через `.animation(.easeInOut(duration: 0.5), value: ...)`
- Архитектура: MVVM, ObservableObject для view models
- Русские комментарии допустимы для отладки, но в финальном коде должны быть на английском

## Особенности реализации
- **Интерфейс**: закрепленная структура с фиксированными высотами для плавных переходов
- **Обложки треков**: механизм обхода кэширования API и сравнение метаданных для корректного отображения
- **Анимации**: плавные переходы с .combined анимациями для opacity и движения
- **Цветовая схема**: адаптивная, основанная на цвете обложки текущего трека
- **Градиентный фон**: динамически меняется в зависимости от цвета обложки
- **Буферизация**: индикация внутри кнопки воспроизведения для сохранения стабильности интерфейса
- **Темный загрузочный экран**: использование UILaunchScreen с настроенным темным цветом фона
- **Анимированные точки**: компонент AnimatedDots для анимации точек в тексте "Подключение..."
- **Автоматический показ paywall**: отслеживание дней использования и показ на 3, 6 и 15 день
- **Режим тестирования paywall**: скрытый режим активируется при длительном нажатии на иконку подарка

## Потенциальные улучшения (идеи для будущих фич)
- Таймер сна (Sleep Timer)
- Кнопка "Поделиться" текущим треком
- Избранное (Favorites)
- История прослушанных треков
- Индикация качества соединения
- Виджет "Сейчас играет"
- Анимация/визуализация звука
- Ссылки на сайт/соцсети радио
- Оптимизация энергопотребления при длительном воспроизведении
- Локальное кэширование обложек для экономии трафика